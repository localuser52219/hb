<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Habit Tracker Pro</title>
    <!-- å¼•å…¥ React å’Œ Babel -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- å¼•å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- åœ–ç¤ºçµ„ä»¶å®šç¾© (å› ç‚ºå–®æª”ç„¡æ³• import lucide-reactï¼Œé€™è£¡ä½¿ç”¨ SVG) -->
    <script type="text/babel">
        const Icons = {
            Calendar: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>,
            CheckCircle: ({className}) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>,
            Gift: ({className}) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polyline points="20 12 20 22 4 22 4 12"></polyline><rect x="2" y="7" width="20" height="5"></rect><line x1="12" y1="22" x2="12" y2="7"></line><path d="M12 7H7.5a2.5 2.5 0 0 1 0-5C11 2 12 7 12 7z"></path><path d="M12 7h4.5a2.5 2.5 0 0 0 0-5C13 2 12 7 12 7z"></path></svg>,
            Settings: ({className}) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>,
            Trash2: ({className}) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>,
            ChevronLeft: ({className}) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polyline points="15 18 9 12 15 6"></polyline></svg>,
            ChevronRight: ({className}) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polyline points="9 18 15 12 9 6"></polyline></svg>,
            Coins: ({className}) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="8"></circle><path d="M9.43 14c-.66.86-1.43 1.4-2.43 1.6-1.5.3-3-.4-3.5-1.9-.5-1.5.4-3 1.9-3.5 1-.33 2.1-.03 2.83.6"></path><path d="M14.57 14c.66.86 1.43 1.4 2.43 1.6 1.5.3 3-.4 3.5-1.9.5-1.5-.4-3-1.9-3.5-1-.33-2.1-.03-2.83.6"></path><path d="M12 8v8"></path></svg>,
            AlertCircle: ({className}) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg>,
            X: ({className}) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
        };
    </script>
</head>
<body class="bg-gray-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        function App() {
            // --- ç‹€æ…‹ç®¡ç† ---
            const [habits, setHabits] = useState(() => {
                const saved = localStorage.getItem('habits');
                if (saved) return JSON.parse(saved);
                
                const oldName = localStorage.getItem('habitName');
                if (oldName) {
                    const oldPoints = parseInt(localStorage.getItem('pointsPerCheckIn')) || 10;
                    return [{ id: 1, name: oldName, points: oldPoints, icon: 'ğŸ“' }];
                }
                
                return [{ id: 1, name: "æ¯æ—¥é–±è®€ 30 åˆ†é˜", points: 10, icon: 'ğŸ“š' }];
            });

            const [checkIns, setCheckIns] = useState(() => {
                const saved = localStorage.getItem('multiHabitCheckIns');
                if (saved) return JSON.parse(saved);

                const oldCheckIns = JSON.parse(localStorage.getItem('checkIns'));
                if (oldCheckIns) {
                    const newCheckIns = {};
                    Object.keys(oldCheckIns).forEach(dateKey => {
                        newCheckIns[`1_${dateKey}`] = true;
                    });
                    return newCheckIns;
                }
                return {};
            });

            const [points, setPoints] = useState(() => parseInt(localStorage.getItem('userPoints')) || 0);
            const [rewards, setRewards] = useState(() => JSON.parse(localStorage.getItem('rewards')) || [
                { id: 1, name: "å–ä¸€æ¯æ‰‹æ–é£²", cost: 50 },
                { id: 2, name: "é€±æœ«çœ‹é›»å½±", cost: 200 },
                { id: 3, name: "è³¼è²·æ–°éŠæˆ²", cost: 1000 }
            ]);
            const [history, setHistory] = useState(() => JSON.parse(localStorage.getItem('history')) || []);

            const [activeTab, setActiveTab] = useState('calendar');
            const [viewDate, setViewDate] = useState(new Date());
            const [selectedDate, setSelectedDate] = useState(new Date());
            
            const [newHabitName, setNewHabitName] = useState("");
            const [newHabitPoints, setNewHabitPoints] = useState(10);
            const [newRewardName, setNewRewardName] = useState("");
            const [newRewardCost, setNewRewardCost] = useState(50);

            // Modal & Toast ç‹€æ…‹
            const [modalConfig, setModalConfig] = useState({ isOpen: false, title: "", message: "", onConfirm: null });
            const [toast, setToast] = useState({ show: false, message: "", type: "success" });

            // --- æ•¸æ“šæŒä¹…åŒ– ---
            useEffect(() => {
                localStorage.setItem('habits', JSON.stringify(habits));
                localStorage.setItem('multiHabitCheckIns', JSON.stringify(checkIns));
                localStorage.setItem('userPoints', points);
                localStorage.setItem('rewards', JSON.stringify(rewards));
                localStorage.setItem('history', JSON.stringify(history));
            }, [habits, checkIns, points, rewards, history]);

            useEffect(() => {
                if (toast.show) {
                    const timer = setTimeout(() => setToast({ ...toast, show: false }), 3000);
                    return () => clearTimeout(timer);
                }
            }, [toast.show]);

            // --- è¼”åŠ©å‡½å¼ ---
            const showToast = (message, type = "success") => {
                setToast({ show: true, message, type });
            };

            const openConfirmModal = (title, message, onConfirm) => {
                setModalConfig({ isOpen: true, title, message, onConfirm });
            };

            const closeConfirmModal = () => {
                setModalConfig({ ...modalConfig, isOpen: false });
            };

            const getDaysInMonth = (year, month) => new Date(year, month + 1, 0).getDate();
            const getFirstDayOfMonth = (year, month) => new Date(year, month, 1).getDay();

            const formatDateKey = (date) => {
                return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
            };

            const handleDateClick = (day) => {
                const newDate = new Date(viewDate.getFullYear(), viewDate.getMonth(), day);
                setSelectedDate(newDate);
                const element = document.getElementById('check-in-section');
                if (element) element.scrollIntoView({ behavior: 'smooth' });
            };

            // --- æ¥­å‹™é‚è¼¯ ---
            const toggleCheckIn = (habitId) => {
                const dateKey = formatDateKey(selectedDate);
                const recordKey = `${habitId}_${dateKey}`;
                const habit = habits.find(h => h.id === habitId);
                
                const today = new Date();
                today.setHours(0,0,0,0);
                const target = new Date(selectedDate);
                target.setHours(0,0,0,0);

                if (target > today) {
                    showToast("ä¸èƒ½é æ”¯æœªä¾†çš„åŠªåŠ›å–”ï¼", "error");
                    return;
                }

                if (checkIns[recordKey]) {
                    const newCheckIns = { ...checkIns };
                    delete newCheckIns[recordKey];
                    setCheckIns(newCheckIns);
                    setPoints(prev => Math.max(0, prev - habit.points));
                } else {
                    setCheckIns({ ...checkIns, [recordKey]: true });
                    setPoints(prev => prev + habit.points);
                }
            };

            const addNewHabit = (e) => {
                e.preventDefault();
                if (!newHabitName.trim()) return;
                const newHabit = {
                    id: Date.now(),
                    name: newHabitName,
                    points: parseInt(newHabitPoints) || 10,
                    icon: 'âœ¨'
                };
                setHabits([...habits, newHabit]);
                setNewHabitName("");
                setNewHabitPoints(10);
                showToast("ç¿’æ…£æ–°å¢æˆåŠŸï¼");
            };

            const deleteHabit = (id) => {
                openConfirmModal(
                    "åˆªé™¤ç¿’æ…£",
                    "ç¢ºå®šè¦åˆªé™¤é€™å€‹ç¿’æ…£å—ï¼Ÿç›¸é—œçš„æ­·å²æ‰“å¡ç´€éŒ„ä¹Ÿæœƒå¤±å»æ„ç¾©ã€‚",
                    () => {
                        setHabits(habits.filter(h => h.id !== id));
                        showToast("ç¿’æ…£å·²åˆªé™¤", "info");
                        closeConfirmModal();
                    }
                );
            };

            const addReward = (e) => {
                e.preventDefault();
                if (!newRewardName.trim()) return;
                setRewards([...rewards, { id: Date.now(), name: newRewardName, cost: parseInt(newRewardCost) }]);
                setNewRewardName("");
                setNewRewardCost(50);
                showToast("çå“æ–°å¢æˆåŠŸï¼");
            };

            const deleteReward = (id) => setRewards(rewards.filter(r => r.id !== id));

            const redeemReward = (reward) => {
                if (points >= reward.cost) {
                    openConfirmModal(
                        "å…Œæ›çå“",
                        `ç¢ºå®šè¦èŠ±è²» ${reward.cost} é»å…Œæ›ã€Œ${reward.name}ã€å—ï¼Ÿ`,
                        () => {
                            setPoints(prev => prev - reward.cost);
                            setHistory([{
                                id: Date.now(),
                                name: reward.name,
                                cost: reward.cost,
                                date: new Date().toLocaleString()
                            }, ...history]);
                            showToast("å…Œæ›æˆåŠŸï¼äº«å—ä½ çš„çå‹µå§ï¼ğŸ‰");
                            closeConfirmModal();
                        }
                    );
                } else {
                    showToast("é»æ•¸ä¸è¶³ï¼Œç¹¼çºŒåŠ æ²¹ï¼ğŸ’ª", "error");
                }
            };

            const getDailyCompletionRate = (day) => {
                const dateKey = formatDateKey(new Date(viewDate.getFullYear(), viewDate.getMonth(), day));
                if (habits.length === 0) return 0;
                
                let completedCount = 0;
                habits.forEach(habit => {
                    if (checkIns[`${habit.id}_${dateKey}`]) completedCount++;
                });
                return completedCount / habits.length;
            };

            // --- UI æ¸²æŸ“ ---
            const renderCalendar = () => {
                const year = viewDate.getFullYear();
                const month = viewDate.getMonth();
                const daysInMonth = getDaysInMonth(year, month);
                const firstDay = getFirstDayOfMonth(year, month);
                const days = [];

                for (let i = 0; i < firstDay; i++) {
                    days.push(<div key={`empty-${i}`} className="h-16 md:h-24 bg-gray-50/50"></div>);
                }

                for (let day = 1; day <= daysInMonth; day++) {
                    const currentDayDate = new Date(year, month, day);
                    const isSelected = formatDateKey(currentDayDate) === formatDateKey(selectedDate);
                    const isToday = formatDateKey(currentDayDate) === formatDateKey(new Date());
                    const completionRate = getDailyCompletionRate(day);
                    
                    let bgClass = "bg-white";
                    if (completionRate === 1) bgClass = "bg-emerald-50 border-emerald-200";
                    else if (completionRate > 0) bgClass = "bg-orange-50 border-orange-200";

                    days.push(
                        <div 
                            key={day} 
                            onClick={() => handleDateClick(day)}
                            className={`h-16 md:h-24 border relative cursor-pointer transition-all duration-200 group flex flex-col items-center justify-start pt-2
                                ${bgClass} ${isSelected ? 'ring-2 ring-indigo-500 z-10' : 'border-gray-100 hover:bg-gray-50'}
                            `}
                        >
                            <span className={`text-sm font-medium ${isToday ? 'bg-indigo-600 text-white w-6 h-6 rounded-full flex items-center justify-center' : 'text-gray-500'}`}>
                                {day}
                            </span>
                            <div className="mt-2 md:mt-4 w-full px-2">
                                {habits.length > 0 && completionRate > 0 && (
                                    <div className="w-full h-1.5 bg-gray-200 rounded-full overflow-hidden">
                                        <div 
                                            className={`h-full rounded-full transition-all duration-500 ${completionRate === 1 ? 'bg-emerald-500' : 'bg-orange-400'}`} 
                                            style={{ width: `${completionRate * 100}%` }}
                                        ></div>
                                    </div>
                                )}
                            </div>
                        </div>
                    );
                }

                return (
                    <div className="space-y-6">
                        <div className="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
                            <div className="flex items-center justify-between p-4 bg-indigo-50 border-b border-indigo-100">
                                <button onClick={() => setViewDate(new Date(viewDate.getFullYear(), viewDate.getMonth() - 1, 1))} className="p-2 hover:bg-indigo-100 rounded-full">
                                    <Icons.ChevronLeft className="w-5 h-5 text-indigo-700" />
                                </button>
                                <h2 className="text-lg font-bold text-indigo-900">{year}å¹´ {month + 1}æœˆ</h2>
                                <button onClick={() => setViewDate(new Date(viewDate.getFullYear(), viewDate.getMonth() + 1, 1))} className="p-2 hover:bg-indigo-100 rounded-full">
                                    <Icons.ChevronRight className="w-5 h-5 text-indigo-700" />
                                </button>
                            </div>
                            <div className="grid grid-cols-7 text-center bg-gray-50 text-xs font-semibold text-gray-500 py-2 border-b border-gray-200">
                                <div>æ—¥</div><div>ä¸€</div><div>äºŒ</div><div>ä¸‰</div><div>å››</div><div>äº”</div><div>å…­</div>
                            </div>
                            <div className="grid grid-cols-7">
                                {days}
                            </div>
                        </div>

                        <div id="check-in-section" className="bg-white rounded-xl shadow-lg border border-indigo-100 overflow-hidden transition-all">
                            <div className="p-4 bg-indigo-600 text-white flex justify-between items-center">
                                <h3 className="font-bold text-lg flex items-center">
                                    <span className="mr-2">ğŸ“…</span>
                                    {selectedDate.getMonth() + 1}æœˆ {selectedDate.getDate()}æ—¥ çš„ç¿’æ…£
                                </h3>
                                <span className="text-xs bg-indigo-500 px-2 py-1 rounded text-indigo-100">
                                    {formatDateKey(selectedDate) === formatDateKey(new Date()) ? 'ä»Šå¤©' : ''}
                                </span>
                            </div>
                            
                            <div className="p-2">
                                {habits.length === 0 ? (
                                    <div className="text-center py-8 text-gray-400">
                                        <p>é‚„æ²’æœ‰è¨­å®šä»»ä½•ç¿’æ…£ï¼Œå»ã€Œè¨­å®šã€é é¢æ–°å¢å§ï¼</p>
                                    </div>
                                ) : (
                                    <div className="grid grid-cols-1 gap-2">
                                        {habits.map(habit => {
                                            const isChecked = checkIns[`${habit.id}_${formatDateKey(selectedDate)}`];
                                            return (
                                                <div 
                                                    key={habit.id}
                                                    onClick={() => toggleCheckIn(habit.id)}
                                                    className={`flex items-center justify-between p-4 rounded-lg cursor-pointer transition-all border
                                                        ${isChecked 
                                                        ? 'bg-emerald-50 border-emerald-200 shadow-sm' 
                                                        : 'bg-white border-gray-100 hover:bg-gray-50'
                                                        }`}
                                                >
                                                    <div className="flex items-center gap-3">
                                                        <div className={`w-6 h-6 rounded-full border-2 flex items-center justify-center transition-colors
                                                            ${isChecked ? 'bg-emerald-500 border-emerald-500' : 'border-gray-300'}`}>
                                                            {isChecked && <Icons.CheckCircle className="w-4 h-4 text-white" />}
                                                        </div>
                                                        <div>
                                                            <p className={`font-bold ${isChecked ? 'text-emerald-800' : 'text-gray-700'}`}>{habit.name}</p>
                                                            <p className="text-xs text-gray-500 flex items-center">
                                                                {isChecked ? 'å·²å®Œæˆ' : 'æœªå®Œæˆ'} â€¢ çå‹µ {habit.points} é»
                                                            </p>
                                                        </div>
                                                    </div>
                                                    <div className={`text-lg font-bold ${isChecked ? 'text-emerald-600' : 'text-gray-300'}`}>
                                                        +{habit.points}
                                                    </div>
                                                </div>
                                            );
                                        })}
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                );
            };

            const renderShop = () => (
                <div className="space-y-6">
                    <div className="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                        <h3 className="text-lg font-bold text-gray-800 mb-4 flex items-center">
                            <Icons.Gift className="w-5 h-5 mr-2 text-indigo-500" /> å…Œæ›å•†åº—
                        </h3>
                        <p className="text-sm text-gray-500 mb-4">ç´¯ç©é»æ•¸ä¾†å…Œæ›çå“ï¼Œå…Œæ›å¾Œæœƒè‡ªå‹•æ‰£é™¤å°æ‡‰é»æ•¸ã€‚</p>
                        
                        <form onSubmit={addReward} className="flex flex-col sm:flex-row gap-4 bg-gray-50 p-4 rounded-lg border border-gray-100">
                            <input
                                type="text"
                                placeholder="è¼¸å…¥çå“åç¨±"
                                value={newRewardName}
                                onChange={(e) => setNewRewardName(e.target.value)}
                                className="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none"
                            />
                            <div className="flex items-center gap-2">
                                <input
                                    type="number"
                                    min="1"
                                    value={newRewardCost}
                                    onChange={(e) => setNewRewardCost(e.target.value)}
                                    className="w-24 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none"
                                />
                                <span className="text-gray-500 text-sm">é»</span>
                            </div>
                            <button type="submit" className="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700">æ–°å¢</button>
                        </form>
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        {rewards.map(reward => (
                            <div key={reward.id} className="bg-white p-5 rounded-xl shadow-sm border border-gray-200 flex justify-between items-center group relative overflow-hidden">
                                <div>
                                    <h4 className="font-bold text-gray-800 text-lg">{reward.name}</h4>
                                    <p className="text-indigo-600 font-medium flex items-center mt-1">
                                        <Icons.Coins className="w-4 h-4 mr-1" /> -{reward.cost} é»
                                    </p>
                                </div>
                                <div className="flex items-center gap-2 z-10">
                                    <button 
                                        onClick={() => redeemReward(reward)}
                                        className={`px-4 py-2 rounded-lg font-medium text-sm transition-colors cursor-pointer ${
                                            points >= reward.cost 
                                                ? 'bg-emerald-100 text-emerald-700 hover:bg-emerald-200' 
                                                : 'bg-gray-100 text-gray-400 hover:bg-gray-200'
                                        }`}
                                    >
                                        å…Œæ›
                                    </button>
                                    <button onClick={() => deleteReward(reward.id)} className="p-2 text-gray-300 hover:text-red-500 transition-colors">
                                        <Icons.Trash2 className="w-4 h-4" />
                                    </button>
                                </div>
                            </div>
                        ))}
                    </div>

                    {history.length > 0 && (
                        <div className="bg-gray-50 rounded-xl p-4 mt-6">
                            <h4 className="text-sm font-bold text-gray-500 mb-3 uppercase tracking-wider">æœ€è¿‘å…Œæ›ç´€éŒ„</h4>
                            <div className="space-y-2">
                                {history.slice(0, 5).map((record) => (
                                    <div key={record.id} className="flex justify-between text-sm">
                                        <span className="text-gray-700">{record.name}</span>
                                        <span className="text-red-400 font-mono">-{record.cost}</span>
                                    </div>
                                ))}
                            </div>
                        </div>
                    )}
                </div>
            );

            const renderSettings = () => (
                <div className="space-y-6">
                    <div className="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                        <h3 className="text-xl font-bold text-gray-800 mb-4 flex items-center">
                            <Icons.Settings className="w-5 h-5 mr-2 text-indigo-600" /> ç¿’æ…£ç®¡ç†
                        </h3>
                        
                        <form onSubmit={addNewHabit} className="flex flex-col md:flex-row gap-4 mb-6 bg-indigo-50 p-4 rounded-lg">
                            <div className="flex-1">
                                <label className="block text-xs font-semibold text-indigo-600 mb-1">ç¿’æ…£åç¨±</label>
                                <input 
                                    type="text" 
                                    placeholder="ä¾‹å¦‚: ç¡å‰å†¥æƒ³"
                                    value={newHabitName} 
                                    onChange={(e) => setNewHabitName(e.target.value)}
                                    className="w-full px-4 py-2 border border-indigo-200 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none"
                                />
                            </div>
                            <div className="w-full md:w-32">
                                <label className="block text-xs font-semibold text-indigo-600 mb-1">ç²å¾—é»æ•¸</label>
                                <input 
                                    type="number" 
                                    min="1"
                                    value={newHabitPoints} 
                                    onChange={(e) => setNewHabitPoints(e.target.value)}
                                    className="w-full px-4 py-2 border border-indigo-200 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none"
                                />
                            </div>
                            <div className="flex items-end">
                                <button type="submit" className="w-full md:w-auto px-6 py-2 bg-indigo-600 text-white font-medium rounded-lg hover:bg-indigo-700">
                                    æ–°å¢ç¿’æ…£
                                </button>
                            </div>
                        </form>

                        <div className="space-y-3">
                            {habits.map(habit => (
                                <div key={habit.id} className="flex items-center justify-between p-3 border border-gray-100 rounded-lg hover:bg-gray-50">
                                    <div className="flex items-center gap-3">
                                        <span className="text-xl bg-gray-100 p-2 rounded-full w-10 h-10 flex items-center justify-center">{habit.icon || 'ğŸ“Œ'}</span>
                                        <div>
                                            <p className="font-bold text-gray-800">{habit.name}</p>
                                            <p className="text-xs text-indigo-500 font-medium">æ¯æ¬¡æ‰“å¡ +{habit.points} é»</p>
                                        </div>
                                    </div>
                                    <button 
                                        onClick={() => deleteHabit(habit.id)}
                                        className="p-2 text-gray-400 hover:text-red-500 hover:bg-red-50 rounded-lg transition-colors"
                                    >
                                        <Icons.Trash2 className="w-4 h-4" />
                                    </button>
                                </div>
                            ))}
                            {habits.length === 0 && <p className="text-center text-gray-400 py-4">ç›®å‰æ²’æœ‰ç¿’æ…£ï¼Œè«‹æ–°å¢ï¼</p>}
                        </div>
                    </div>

                    <div className="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                        <h3 className="text-lg font-bold text-gray-800 mb-4">è³‡æ–™ç®¡ç†</h3>
                        <button 
                            onClick={() => {
                                openConfirmModal("é‡ç½®æ•¸æ“š", "ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰è³‡æ–™é‡ä¾†å—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸã€‚", () => {
                                    localStorage.clear();
                                    window.location.reload();
                                });
                            }}
                            className="text-red-500 hover:text-red-700 text-sm font-medium flex items-center"
                        >
                            <Icons.Trash2 className="w-4 h-4 mr-1" /> é‡ç½®æ‰€æœ‰æ‡‰ç”¨ç¨‹å¼æ•¸æ“š
                        </button>
                    </div>
                </div>
            );

            return (
                <div className="min-h-screen pb-20 md:pb-10 relative">
                    {/* Toast */}
                    {toast.show && (
                        <div className={`fixed top-4 left-1/2 transform -translate-x-1/2 z-[100] px-6 py-3 rounded-full shadow-lg flex items-center gap-2 transition-all duration-300
                            ${toast.type === 'error' ? 'bg-red-500 text-white' : 'bg-gray-800 text-white'}
                        `}>
                            {toast.type === 'error' ? <Icons.AlertCircle className="w-5 h-5" /> : <Icons.CheckCircle className="w-5 h-5" />}
                            <span className="font-medium">{toast.message}</span>
                        </div>
                    )}

                    {/* Modal */}
                    {modalConfig.isOpen && (
                        <div className="fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm">
                            <div className="bg-white rounded-xl shadow-2xl max-w-sm w-full p-6">
                                <h3 className="text-xl font-bold text-gray-900 mb-2">{modalConfig.title}</h3>
                                <p className="text-gray-600 mb-6">{modalConfig.message}</p>
                                <div className="flex justify-end gap-3">
                                    <button 
                                        onClick={closeConfirmModal}
                                        className="px-4 py-2 rounded-lg text-gray-600 hover:bg-gray-100 font-medium transition-colors"
                                    >
                                        å–æ¶ˆ
                                    </button>
                                    <button 
                                        onClick={modalConfig.onConfirm}
                                        className="px-4 py-2 rounded-lg bg-indigo-600 text-white hover:bg-indigo-700 font-medium transition-colors"
                                    >
                                        ç¢ºå®š
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Header */}
                    <header className="bg-white border-b border-gray-200 sticky top-0 z-20 shadow-sm">
                        <div className="max-w-4xl mx-auto px-4 py-4 flex flex-row items-center justify-between">
                            <div>
                                <h1 className="text-xl font-black text-indigo-900 tracking-tight">Habit Tracker Pro</h1>
                                <p className="text-xs text-gray-500 hidden sm:block">å¤šç¿’æ…£é¤Šæˆ & é»æ•¸å…Œæ›ç³»çµ±</p>
                            </div>
                            
                            <div className="flex items-center gap-3 bg-gradient-to-r from-yellow-50 to-orange-50 px-4 py-2 rounded-full border border-orange-100 shadow-sm">
                                <Icons.Coins className="w-5 h-5 text-orange-500" />
                                <div>
                                    <span className="text-[10px] text-orange-400 font-bold uppercase tracking-wider block leading-none">éŒ¢åŒ…é¤˜é¡</span>
                                    <span className="text-lg font-bold text-orange-700 leading-none">{points}</span>
                                </div>
                            </div>
                        </div>
                    </header>

                    {/* Main */}
                    <main className="max-w-4xl mx-auto px-4 py-6">
                        {activeTab === 'calendar' && renderCalendar()}
                        {activeTab === 'shop' && renderShop()}
                        {activeTab === 'settings' && renderSettings()}
                    </main>

                    {/* Mobile Nav */}
                    <nav className="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 px-6 py-3 flex justify-around items-center z-50 md:hidden shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.05)]">
                        <button onClick={() => setActiveTab('calendar')} className={`flex flex-col items-center gap-1 ${activeTab === 'calendar' ? 'text-indigo-600' : 'text-gray-400'}`}>
                            <Icons.Calendar className="w-6 h-6" />
                            <span className="text-[10px] font-medium">æ‰“å¡</span>
                        </button>
                        <button onClick={() => setActiveTab('shop')} className={`flex flex-col items-center gap-1 ${activeTab === 'shop' ? 'text-indigo-600' : 'text-gray-400'}`}>
                            <Icons.Gift className="w-6 h-6" />
                            <span className="text-[10px] font-medium">å…Œæ›</span>
                        </button>
                        <button onClick={() => setActiveTab('settings')} className={`flex flex-col items-center gap-1 ${activeTab === 'settings' ? 'text-indigo-600' : 'text-gray-400'}`}>
                            <Icons.Settings className="w-6 h-6" />
                            <span className="text-[10px] font-medium">ç¿’æ…£</span>
                        </button>
                    </nav>

                    {/* Desktop Nav */}
                    <div className="hidden md:flex justify-center gap-4 mt-6">
                        {['calendar', 'shop', 'settings'].map(tab => (
                            <button 
                                key={tab}
                                onClick={() => setActiveTab(tab)}
                                className={`px-8 py-2.5 rounded-full font-bold transition-all transform hover:scale-105 ${
                                activeTab === tab 
                                    ? 'bg-indigo-600 text-white shadow-lg shadow-indigo-200' 
                                    : 'bg-white text-gray-500 hover:bg-gray-100 border border-gray-200'
                                }`}
                            >
                                {tab === 'calendar' ? 'æ‰“å¡æ—¥æ›†' : tab === 'shop' ? 'çå‹µå…Œæ›' : 'ç¿’æ…£è¨­å®š'}
                            </button>
                        ))}
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
